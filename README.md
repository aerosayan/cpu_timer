# **cpu\_timer - A modern Fortran (2008+) library for timing program execution**

An object-oriented library for computing elapsed CPU time. More specifically, you can determine the CPU time consumed by a particular piece of your code, that is:

```fortran

	!... start timer
	
	do i = 1, n
		
		!...some big calculation...
	
	end do
	
	!...stop timer
	
	print *, 'Elapsed CPU time = ', blah
```



-----------------------------------------------------------------------------

## Contributing

This project is still a work in progress and anyone is free to contribute under the proviso that they abstain from using the dreaded **go to**.

For bug reports or feature requests please open an issue on github.

-----------------------------------------------------------------------------

## Requirements
* The GNU Make tool https://www.gnu.org/software/make/
* The GNU gfortran compiler https://gcc.gnu.org/wiki/GFortran

-----------------------------------------------------------------------------

## To build the project

Type the following command line arguments
```
git clone https://github.com/jlokimlin/cpu_timer.git

cd cpu_timer; make all
```

-----------------------------------------------------------------------------

## Usage:

```fortran

use, intrinsic :: iso_fortran_env, only: &
    wp => REAL64, &
    ip => INT32
    
use type_CpuTimer, only: &
    CpuTimer

! Explicit typing only
implicit none

type (CpuTimer) :: timer
real (wp)       :: wall_clock_time
real (wp)	    :: total_processor_time
integer (ip)    :: units = 0 ! (optional argument) = 0 for seconds, or 1 for minutes, or 2 for hours

! Starting the timer
call timer%start()

! Stopping the timer
call timer%stop()

! Reading the time
wall_clock_time = timer%get_elapsed_time(units)

total_processor_time = timer%get_total_cpu_time(units)

! Write time stamp to standard output
call timer%print_time_stamp()

! Write compiler info to standard output
call timer%print_compiler_info()

```

-----------------------------------------------------------------------------

## Result

```
	  
	Demonstrate the usage of type (CpuTimer).
	
	May 21 2016   6:27:13.134 PM
	
	*********************************************
	
	 time_random_number_routine
	
	 times the intrinsic random_number routine:
	
	    call random_number( x(1:n) )
	
	  Data vectors will be of minimum size              1
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         MINVAL         SUM            MAXVAL         
	
	          1    1.90116E-02    1.61767E-02    1.47010E-02    1.53903E-02    1.49967E-02    1.47010E-02    1.60553E-02    1.90116E-02
	          2    1.46618E-02    1.54610E-02    1.57725E-02    1.51833E-02    1.68996E-02    1.46618E-02    1.55956E-02    1.68996E-02
	          4    1.60070E-02    1.49810E-02    1.46898E-02    1.55999E-02    1.48252E-02    1.46898E-02    1.52206E-02    1.60070E-02
	          8    1.59509E-02    1.58208E-02    1.59485E-02    1.49698E-02    1.51651E-02    1.49698E-02    1.55710E-02    1.59509E-02
	         16    1.60431E-02    1.47531E-02    1.49210E-02    1.50497E-02    1.48944E-02    1.47531E-02    1.51323E-02    1.60431E-02
	         32    1.46079E-02    1.49119E-02    1.45898E-02    1.46156E-02    1.44375E-02    1.44375E-02    1.46325E-02    1.49119E-02
	         64    1.50730E-02    1.46645E-02    1.47886E-02    1.48503E-02    1.44036E-02    1.44036E-02    1.47560E-02    1.50730E-02
	        128    1.45182E-02    1.93170E-02    1.80016E-02    1.56422E-02    1.55603E-02    1.45182E-02    1.66078E-02    1.93170E-02
	        256    1.48892E-02    1.50796E-02    1.50630E-02    1.48680E-02    1.51712E-02    1.48680E-02    1.50142E-02    1.51712E-02
	        512    1.51248E-02    1.55649E-02    1.63753E-02    1.73678E-02    1.49957E-02    1.49957E-02    1.58857E-02    1.73678E-02
	       1024    1.62467E-02    1.45111E-02    1.50830E-02    1.44700E-02    1.48207E-02    1.44700E-02    1.50263E-02    1.62467E-02
	       2048    1.49164E-02    1.48374E-02    1.44434E-02    1.47483E-02    1.48960E-02    1.44434E-02    1.47683E-02    1.49164E-02
	       4096    1.44067E-02    1.53800E-02    1.70801E-02    1.91328E-02    1.63478E-02    1.44067E-02    1.64695E-02    1.91328E-02
	       8192    1.54906E-02    1.55012E-02    1.53056E-02    1.50365E-02    1.53405E-02    1.50365E-02    1.53349E-02    1.55012E-02
	      16384    1.45477E-02    1.46621E-02    1.63308E-02    1.51800E-02    1.47133E-02    1.45477E-02    1.50868E-02    1.63308E-02
	      32768    1.46001E-02    1.45621E-02    1.45514E-02    1.44878E-02    1.60267E-02    1.44878E-02    1.48456E-02    1.60267E-02
	      65536    1.45363E-02    1.52500E-02    1.44567E-02    1.46702E-02    1.43493E-02    1.43493E-02    1.46525E-02    1.52500E-02
	     131072    1.47082E-02    1.59243E-02    1.44925E-02    1.46577E-02    1.52959E-02    1.44925E-02    1.50157E-02    1.59243E-02
	     262144    1.51687E-02    1.48432E-02    1.56300E-02    1.52293E-02    1.47340E-02    1.47340E-02    1.51210E-02    1.56300E-02
	     524288    1.47115E-02    1.46949E-02    1.49444E-02    1.45615E-02    1.54982E-02    1.45615E-02    1.48821E-02    1.54982E-02
	    1048576    1.49174E-02    1.46517E-02    1.46729E-02    1.46605E-02    1.53214E-02    1.46517E-02    1.48448E-02    1.53214E-02
	
	*********************************************
	
	  time_vectorized_exp_routine:
	
	    y(1:n) = x(1:n)  
	    y(1:n) = PI * x(1:n)  
	    y(1:n) = sqrt( x(1:n) )
	    y(1:n) = exp( x(1:n) )
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    1.40876E-02    3.69015E-03    3.60776E-03    5.09785E-03    3.70723E-03
	       8192    3.90994E-03    3.56830E-03    3.65573E-03    3.64910E-03    3.62830E-03
	      16384    3.61433E-03    3.65394E-03    3.65173E-03    3.59268E-03    3.62376E-03
	      32768    3.66871E-03    3.54769E-03    3.60649E-03    3.64752E-03    3.74019E-03
	      65536    3.82034E-03    3.65489E-03    3.67323E-03    8.31589E-03    3.53219E-03
	     131072    1.12169E-02    3.64127E-03    3.66074E-03    3.65709E-03    3.56822E-03
	     262144    5.23187E-03    3.60817E-03    3.79942E-03    3.67104E-03    3.53881E-03
	     524288    3.68488E-03    3.63763E-03    3.78108E-03    3.72284E-03    4.89020E-03
	    1048576    3.69498E-03    3.62024E-03    9.87634E-03    3.68202E-03    3.83931E-03
	    2097152    3.61637E-03    3.63179E-03    4.10046E-03    3.64666E-03    3.67411E-03
	    4194304    3.62086E-03    3.65079E-03    5.76867E-03    3.61546E-03    7.45929E-03
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    5.74079E-03    5.82113E-03    5.71084E-03    7.13666E-03    5.44805E-03
	       8192    6.23015E-03    5.63443E-03    5.72154E-03    6.21072E-03    5.37846E-03
	      16384    5.40358E-03    1.10028E-02    5.47233E-03    5.45489E-03    5.41761E-03
	      32768    6.27224E-03    5.69585E-03    5.50484E-03    5.45066E-03    7.26507E-03
	      65536    5.49911E-03    5.45485E-03    5.59469E-03    5.63963E-03    5.73972E-03
	     131072    5.57668E-03    5.61789E-03    5.54679E-03    5.43480E-03    5.53666E-03
	     262144    5.77725E-03    5.72594E-03    5.53110E-03    5.53492E-03    5.44429E-03
	     524288    5.49986E-03    5.44843E-03    5.44947E-03    5.86954E-03    5.96918E-03
	    1048576    5.56359E-03    7.03719E-03    5.54491E-03    5.42927E-03    5.58806E-03
	    2097152    5.71913E-03    5.74806E-03    5.45442E-03    5.50575E-03    1.19972E-02
	    4194304    5.72567E-03    5.48821E-03    5.49108E-03    5.50793E-03    6.65174E-03
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    1.20938E-02    1.18837E-02    1.14272E-02    1.54347E-02    1.14858E-02
	       8192    1.67042E-02    1.49923E-02    1.15961E-02    1.34462E-02    1.14554E-02
	      16384    1.21898E-02    1.21855E-02    1.18028E-02    1.76319E-02    1.15800E-02
	      32768    1.47743E-02    1.25529E-02    1.14353E-02    1.14812E-02    1.32345E-02
	      65536    1.23358E-02    1.47458E-02    1.14652E-02    1.21228E-02    1.56440E-02
	     131072    1.49085E-02    1.23722E-02    1.21673E-02    1.63251E-02    1.48994E-02
	     262144    1.47038E-02    2.04437E-02    1.18348E-02    1.49286E-02    1.62845E-02
	     524288    1.23015E-02    1.15743E-02    1.53495E-02    2.65797E-02    1.63622E-02
	    1048576    1.46328E-02    1.15542E-02    1.44151E-02    1.50199E-02    1.31022E-02
	    2097152    1.45630E-02    1.15016E-02    1.62715E-02    1.55801E-02    1.15667E-02
	    4194304    1.49663E-02    1.20797E-02    1.59881E-02    1.35404E-02    1.46036E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    9.83881E-02    7.59276E-02    9.03197E-02    9.87015E-02    1.09653E-01
	       8192    8.73129E-02    8.63047E-02    8.98408E-02    1.12936E-01    8.51898E-02
	      16384    7.68230E-02    9.86035E-02    8.08050E-02    8.17795E-02    9.24353E-02
	      32768    8.15478E-02    8.48342E-02    1.21146E-01    7.71178E-02    1.06937E-01
	      65536    9.40830E-02    8.59013E-02    1.38787E-01    7.75807E-02    7.67385E-02
	     131072    9.17705E-02    7.69332E-02    1.50040E-01    1.11445E-01    8.88781E-02
	     262144    8.07102E-02    7.99944E-02    1.50223E-01    1.14421E-01    9.33543E-02
	     524288    9.42804E-02    1.16003E-01    1.19135E-01    1.07287E-01    7.75532E-02
	    1048576    8.64011E-02    8.49542E-02    1.19570E-01    9.77666E-02    7.66476E-02
	    2097152    1.14774E-01    8.61205E-02    9.02717E-02    1.18369E-01    9.76959E-02
	    4194304    9.75500E-02    9.53215E-02    8.96604E-02    1.18295E-01    9.51444E-02
	
	*********************************************
	
	 time_unvectorized_exp_routine
	
	    do i = 1, n
	      y(i) = x(i)  
	      y(i) = PI * x(i)  
	      y(i) = sqrt(x(i))
	      y(i) = exp(x(i))
	    end do
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    5.94180E-05    1.78180E-05    1.98420E-05    1.84060E-05    2.69710E-05
	       8192    1.04894E-04    3.80520E-05    3.85790E-05    3.28350E-05    3.86480E-05
	      16384    1.00891E-04    8.17970E-05    7.35150E-05    6.79040E-05    1.23168E-04
	      32768    2.73878E-04    1.07882E-04    1.53535E-04    1.84727E-04    2.53648E-04
	      65536    3.02056E-04    2.15226E-04    2.86712E-04    5.58772E-04    4.15272E-04
	     131072    6.15174E-04    5.05942E-04    1.06848E-03    6.69999E-04    6.14821E-04
	     262144    1.52465E-03    1.18346E-03    1.73506E-03    1.39440E-03    1.36600E-03
	     524288    2.43523E-03    1.99000E-03    2.14338E-03    2.68075E-03    2.47709E-03
	    1048576    5.68733E-03    5.59964E-03    3.96489E-03    3.81701E-03    5.94500E-03
	    2097152    9.46014E-03    9.32131E-03    1.16915E-02    9.74251E-03    1.14536E-02
	    4194304    1.92250E-02    2.16742E-02    2.25714E-02    2.23977E-02    2.40070E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.81540E-05    1.35660E-05    1.36250E-05    1.35890E-05    2.03250E-05
	       8192    5.49410E-05    2.69270E-05    4.37500E-05    2.66810E-05    2.70250E-05
	      16384    1.06544E-04    5.29570E-05    1.10150E-04    5.37560E-05    5.36130E-05
	      32768    2.98798E-04    1.07003E-04    2.18916E-04    1.06959E-04    1.06734E-04
	      65536    6.31318E-04    2.11440E-04    6.18970E-04    2.12829E-04    2.13401E-04
	     131072    1.00961E-03    4.26373E-04    8.64443E-04    4.26821E-04    4.50257E-04
	     262144    1.87459E-03    8.85527E-04    2.13284E-03    8.64113E-04    8.75745E-04
	     524288    5.04992E-03    3.40633E-03    1.84730E-03    1.69999E-03    1.70250E-03
	    1048576    8.09325E-03    7.18970E-03    5.82768E-03    3.51763E-03    3.93760E-03
	    2097152    1.22137E-02    1.15151E-02    7.73571E-03    7.03012E-03    6.75209E-03
	    4194304    1.39680E-02    2.85462E-02    1.42904E-02    1.42061E-02    1.47257E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    1.99690E-05    1.40940E-05    1.41870E-05    2.35480E-05    2.18320E-05
	       8192    2.92120E-05    2.72440E-05    2.81450E-05    4.47010E-05    4.63170E-05
	      16384    5.73840E-05    5.35070E-05    5.53650E-05    8.72250E-05    8.11120E-05
	      32768    1.14967E-04    1.07193E-04    1.34194E-04    1.77412E-04    1.17252E-04
	      65536    2.30707E-04    2.14526E-04    2.24807E-04    4.82992E-04    2.46147E-04
	     131072    4.67068E-04    4.46597E-04    4.49151E-04    5.59372E-04    9.73280E-04
	     262144    9.11329E-04    9.42337E-04    9.09333E-04    1.64255E-03    1.39107E-03
	     524288    1.79258E-03    1.86400E-03    1.79923E-03    3.88772E-03    2.67231E-03
	    1048576    3.82976E-03    3.68392E-03    3.81921E-03    6.38558E-03    7.49534E-03
	    2097152    7.56623E-03    7.27376E-03    8.95026E-03    1.44057E-02    8.35191E-03
	    4194304    1.50667E-02    1.52732E-02    2.43222E-02    2.41300E-02    2.14965E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    9.45920E-05    1.08062E-04    9.60730E-05    1.59540E-04    9.23830E-05
	       8192    1.91801E-04    2.11944E-04    1.83320E-04    2.99183E-04    1.84274E-04
	      16384    3.67292E-04    3.76492E-04    3.66736E-04    5.98019E-04    3.78527E-04
	      32768    1.19889E-03    7.26570E-04    7.25027E-04    1.18829E-03    7.83852E-04
	      65536    1.97309E-03    1.44731E-03    1.44040E-03    2.41560E-03    1.49661E-03
	     131072    3.01491E-03    2.85889E-03    3.54868E-03    4.87817E-03    2.93058E-03
	     262144    6.80555E-03    5.58321E-03    5.95317E-03    6.03240E-03    6.16584E-03
	     524288    1.76930E-02    1.10953E-02    1.32223E-02    1.13305E-02    1.20447E-02
	    1048576    3.45350E-02    3.05144E-02    2.79971E-02    2.27156E-02    2.61888E-02
	    2097152    6.66628E-02    4.51586E-02    5.55583E-02    4.49161E-02    5.66498E-02
	    4194304    9.95039E-02    1.05168E-01    1.36064E-01    9.46949E-02    1.09023E-01
	
	*********************************************
	
	  time_2d_nearest_neighbor_problem
	
	  Given x(2,n) and y(2),
	
	    find x(2,*) closest to y(2).
	
	    do i = 1, n
	      if distance( x(2,i), y ) < minimum so far
	        x_min = x(2,i)
	    end do
	
	  Data vectors will be of minimum size           1024
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       1024    1.10870E-05    1.23530E-05    6.82900E-06    1.05390E-05    1.19760E-05
	       2048    1.64900E-05    2.30190E-05    1.20740E-05    2.00120E-05    2.22220E-05
	       4096    2.80320E-05    4.35620E-05    2.43360E-05    3.98980E-05    4.24960E-05
	       8192    6.08340E-05    8.96280E-05    4.68970E-05    7.85460E-05    8.38870E-05
	      16384    1.14994E-04    1.86108E-04    1.55535E-04    1.67996E-04    1.66693E-04
	      32768    2.40366E-04    3.89795E-04    3.18698E-04    3.38130E-04    3.34818E-04
	      65536    4.86377E-04    7.66828E-04    6.99497E-04    6.79427E-04    6.69512E-04
	     131072    7.32526E-04    1.44712E-03    1.34432E-03    1.07343E-03    1.38310E-03
	     262144    1.73435E-03    2.79770E-03    2.64562E-03    1.49735E-03    2.79869E-03
	     524288    4.76834E-03    5.33610E-03    5.48858E-03    3.40674E-03    5.55195E-03
	    1048576    1.12644E-02    7.44489E-03    1.13355E-02    9.63689E-03    7.67844E-03
	
	*********************************************
	
	  time_matrix_multiplication_problem
	
	  Compute C = A * B
	
	  where
	    A is an L by M matrix,
	    B is an M by N matrix,
	  and so
	    C is an L by N matrix.
	
	  Minimum value of L = M = N =                      4
	  Maximum value of L = M = N =                   1024
	  Number of repetitions of the operation:           5
	
	  Use nested do loops for matrix multiplication.
	
	  Timing results using nested do loops:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    1.78300E-06    1.38500E-06    1.40900E-06    1.43000E-06    1.39100E-06
	         16    5.36250E-05    4.81330E-05    4.98050E-05    4.81510E-05    4.97940E-05
	         64    3.22708E-03    2.90603E-03    2.89970E-03    2.89503E-03    2.89826E-03
	        256    2.94019E-01    2.51492E-01    2.52277E-01    2.53504E-01    2.55372E-01
	       1024    3.52399E+01    3.25426E+01    3.76984E+01    3.93008E+01    3.94100E+01
	
	  Use the matmul routine for matrix multiplication.
	
	  Timing results using matmul:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    2.17864E-03    2.16700E-06    2.40200E-06    2.07100E-06    1.97400E-06
	         16    7.08400E-06    3.03000E-06    3.12200E-06    3.07900E-06    3.10700E-06
	         64    2.11042E-04    1.11518E-04    9.84600E-05    9.84640E-05    9.81870E-05
	        256    1.39533E-02    7.16288E-03    7.17773E-03    9.18890E-03    7.17723E-03
	       1024    6.37664E-01    7.23309E-01    6.91335E-01    6.85059E-01    7.37092E-01
	
	 type (CpuTimer) tests.
	
	 Normal end of execution.
	
	May 21 2016   6:30:49.657 PM
	
	This file was compiled by GCC version 5.3.1 20160509 using the options -I ../objs -I ../lib -mtune=generic -march=x86-64 -auxbase-strip ../objs/type_CpuTimer.o -Wall -fimplicit-none -fcheck=all -J ../lib

		
```