# **cpu\_timer - A modern Fortran (2008+) library for timing program execution**

An object-oriented library for computing elapsed CPU time. More specifically, you can determine the CPU time consumed by a particular piece of your code, that is:

```fortran

	!... start timer
	
	do i = 1, n
		
		!...some big calculation...
	
	end do
	
	!...stop timer
	
	print *, 'Elapsed CPU time = ', blah
```



-----------------------------------------------------------------------------

## Contributing

This project is still a work in progress and anyone is free to contribute under the proviso that they abstain from using the dreaded **go to**.

For bug reports or feature requests please open an issue on github.

-----------------------------------------------------------------------------

## Requirements
* The GNU Make tool https://www.gnu.org/software/make/
* The GNU gfortran compiler https://gcc.gnu.org/wiki/GFortran

-----------------------------------------------------------------------------

## To build the project

Type the following command line arguments
```
git clone https://github.com/jlokimlin/cpu_timer.git

cd cpu_timer; make all
```

-----------------------------------------------------------------------------

## Usage:

```fortran

use, intrinsic :: iso_fortran_env, only: &
    wp => REAL64, &
    ip => INT32
    
use cpu_timer_library, only: &
    CpuTimer

! Explicit typing only
implicit none

type (CpuTimer) :: timer
real (wp)       :: wall_clock_time
real (wp)	    :: total_processor_time
integer (ip)    :: units = 0 ! (optional argument) = 0 for seconds, or 1 for minutes, or 2 for hours

! Starting the timer
call timer%start()

! Stopping the timer
call timer%stop()

! Reading the time
wall_clock_time = timer%get_elapsed_time(units)

total_processor_time = timer%get_total_cpu_time(units)

! Write time stamp to standard output
call timer%print_time_stamp()

! Write compiler info to standard output
call timer%print_compiler_info()

```

-----------------------------------------------------------------------------

## Result

```
	  
	  Demonstrate the usage of type (CpuTimer).
	
	May 24 2016  10:38:25.016 AM
	
	*********************************************
	
	 time_random_number_routine
	
	 times the intrinsic random_number routine:
	
	    call random_number( x(1:n) )
	
	  Data vectors will be of minimum size              1
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         MINVAL         SUM            MAXVAL         
	
	          1    3.91743E-02    3.32390E-02    3.31433E-02    3.31393E-02    3.32701E-02    3.31393E-02    3.43932E-02    3.91743E-02
	          2    3.30102E-02    3.32253E-02    3.32392E-02    3.32529E-02    3.31790E-02    3.30102E-02    3.31813E-02    3.32529E-02
	          4    3.32163E-02    3.30703E-02    3.32484E-02    3.32125E-02    3.30952E-02    3.30703E-02    3.31685E-02    3.32484E-02
	          8    3.31120E-02    3.31503E-02    3.30878E-02    3.32094E-02    3.32446E-02    3.30878E-02    3.31608E-02    3.32446E-02
	         16    3.31551E-02    3.31098E-02    3.30965E-02    3.30887E-02    3.31595E-02    3.30887E-02    3.31219E-02    3.31595E-02
	         32    3.31787E-02    3.32432E-02    3.31182E-02    3.31899E-02    3.31325E-02    3.31182E-02    3.31725E-02    3.32432E-02
	         64    3.32984E-02    3.31758E-02    3.31736E-02    3.31320E-02    3.32153E-02    3.31320E-02    3.31990E-02    3.32984E-02
	        128    3.30392E-02    3.32259E-02    3.31944E-02    3.31997E-02    3.35277E-02    3.30392E-02    3.32374E-02    3.35277E-02
	        256    3.36790E-02    3.32035E-02    3.34561E-02    3.35241E-02    3.30958E-02    3.30958E-02    3.33917E-02    3.36790E-02
	        512    3.32422E-02    3.34070E-02    3.32399E-02    3.33012E-02    3.34267E-02    3.32399E-02    3.33234E-02    3.34267E-02
	       1024    3.32389E-02    3.33010E-02    3.35067E-02    3.36491E-02    3.33143E-02    3.32389E-02    3.34020E-02    3.36491E-02
	       2048    3.33389E-02    3.36641E-02    3.33333E-02    3.33391E-02    3.33211E-02    3.33211E-02    3.33993E-02    3.36641E-02
	       4096    3.52347E-02    3.37323E-02    3.34474E-02    3.32084E-02    3.33545E-02    3.32084E-02    3.37955E-02    3.52347E-02
	       8192    3.33430E-02    3.31905E-02    3.33619E-02    3.32329E-02    3.31667E-02    3.31667E-02    3.32590E-02    3.33619E-02
	      16384    3.32974E-02    3.31598E-02    3.32017E-02    3.33431E-02    3.31966E-02    3.31598E-02    3.32397E-02    3.33431E-02
	      32768    3.30997E-02    3.33089E-02    3.31697E-02    3.30784E-02    3.32124E-02    3.30784E-02    3.31738E-02    3.33089E-02
	      65536    3.31675E-02    3.31790E-02    3.33443E-02    3.33777E-02    3.31911E-02    3.31675E-02    3.32519E-02    3.33777E-02
	     131072    3.33092E-02    3.31802E-02    3.30692E-02    3.32473E-02    3.31285E-02    3.30692E-02    3.31869E-02    3.33092E-02
	     262144    3.30826E-02    3.32451E-02    3.33047E-02    3.32072E-02    3.31788E-02    3.30826E-02    3.32037E-02    3.33047E-02
	     524288    3.31803E-02    3.30838E-02    3.32759E-02    3.30999E-02    3.31699E-02    3.30838E-02    3.31620E-02    3.32759E-02
	    1048576    3.32931E-02    3.32324E-02    3.30865E-02    3.36035E-02    3.31896E-02    3.30865E-02    3.32810E-02    3.36035E-02
	
	*********************************************
	
	  time_vectorized_exp_routine:
	
	    y(1:n) = x(1:n)  
	    y(1:n) = PI * x(1:n)  
	    y(1:n) = sqrt( x(1:n) )
	    y(1:n) = exp( x(1:n) )
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    3.71479E-02    2.48094E-02    2.84334E-02    2.05438E-02    2.36327E-02
	       8192    2.44204E-02    1.99884E-02    2.32147E-02    2.74287E-02    2.23288E-02
	      16384    2.53013E-02    2.62076E-02    2.28198E-02    2.22330E-02    2.69763E-02
	      32768    3.27042E-02    2.45285E-02    2.69859E-02    3.08544E-02    2.28186E-02
	      65536    3.32041E-02    3.32467E-02    2.57333E-02    2.80174E-02    2.52812E-02
	     131072    2.92484E-02    2.31661E-02    2.64511E-02    2.18989E-02    2.02343E-02
	     262144    2.70376E-02    2.06920E-02    2.13714E-02    2.64591E-02    2.34554E-02
	     524288    2.06735E-02    2.25817E-02    2.69317E-02    2.25359E-02    2.83346E-02
	    1048576    2.62044E-02    2.54230E-02    2.59324E-02    2.43829E-02    2.26270E-02
	    2097152    2.09569E-02    2.64085E-02    3.68587E-02    2.30390E-02    3.27207E-02
	    4194304    2.52890E-02    2.50552E-02    2.39055E-02    2.37873E-02    2.58260E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.53199E-02    2.18202E-02    2.53709E-02    2.74419E-02    2.39773E-02
	       8192    2.68803E-02    2.70169E-02    2.71636E-02    2.29886E-02    2.53207E-02
	      16384    2.29352E-02    2.50192E-02    2.70482E-02    2.49787E-02    2.47054E-02
	      32768    2.86401E-02    2.24757E-02    3.45117E-02    2.94317E-02    2.50124E-02
	      65536    2.17056E-02    2.74713E-02    2.62509E-02    2.92221E-02    2.92157E-02
	     131072    2.76813E-02    2.83456E-02    2.39407E-02    2.87801E-02    2.39043E-02
	     262144    2.52419E-02    2.60225E-02    2.25034E-02    2.65011E-02    3.13589E-02
	     524288    2.96044E-02    2.20922E-02    2.84032E-02    2.62617E-02    2.54799E-02
	    1048576    2.61711E-02    2.55354E-02    2.40160E-02    3.17661E-02    2.53293E-02
	    2097152    2.69771E-02    2.51048E-02    2.46324E-02    2.97144E-02    2.89343E-02
	    4194304    2.87800E-02    2.13539E-02    2.24500E-02    2.92650E-02    2.54374E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    6.01123E-02    5.95910E-02    5.89470E-02    6.04002E-02    6.21814E-02
	       8192    6.47835E-02    6.04287E-02    5.94401E-02    6.78395E-02    6.21952E-02
	      16384    6.22657E-02    6.25543E-02    5.99892E-02    5.94504E-02    6.31576E-02
	      32768    6.67978E-02    7.04470E-02    6.67700E-02    6.25536E-02    6.04636E-02
	      65536    6.35985E-02    7.20255E-02    6.79702E-02    6.14874E-02    5.98372E-02
	     131072    9.16839E-02    6.66031E-02    5.88662E-02    5.87895E-02    6.29137E-02
	     262144    7.63462E-02    6.89273E-02    6.11125E-02    6.01553E-02    6.74450E-02
	     524288    6.20881E-02    7.03765E-02    6.20035E-02    5.89194E-02    6.13236E-02
	    1048576    6.22088E-02    5.96977E-02    6.04129E-02    6.13817E-02    6.21574E-02
	    2097152    6.46642E-02    6.21071E-02    5.88720E-02    6.21677E-02    6.02594E-02
	    4194304    6.58189E-02    6.15090E-02    7.05020E-02    7.02415E-02    7.22001E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.49980E-01    2.49754E-01    2.45030E-01    2.42593E-01    2.42350E-01
	       8192    2.53057E-01    2.49375E-01    2.43778E-01    2.42167E-01    2.43262E-01
	      16384    2.56808E-01    2.44111E-01    2.42516E-01    2.42759E-01    2.41917E-01
	      32768    2.64038E-01    2.44008E-01    2.47844E-01    2.46481E-01    2.41314E-01
	      65536    2.46710E-01    2.52582E-01    2.47495E-01    2.43806E-01    2.41148E-01
	     131072    2.48019E-01    2.42848E-01    2.42571E-01    2.42884E-01    2.45880E-01
	     262144    2.56282E-01    2.42678E-01    2.53114E-01    2.42744E-01    2.43330E-01
	     524288    2.56396E-01    2.53105E-01    2.42741E-01    2.42047E-01    2.41446E-01
	    1048576    2.53527E-01    2.53109E-01    2.42598E-01    2.42252E-01    2.52189E-01
	    2097152    2.50898E-01    2.43461E-01    2.42235E-01    2.49031E-01    2.58960E-01
	    4194304    2.52930E-01    2.56149E-01    2.41966E-01    2.42028E-01    2.44781E-01
	
	*********************************************
	
	 time_unvectorized_exp_routine
	
	    do i = 1, n
	      y(i) = x(i)  
	      y(i) = PI * x(i)  
	      y(i) = sqrt(x(i))
	      y(i) = exp(x(i))
	    end do
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    6.35100E-05    3.52510E-05    4.07540E-05    3.54790E-05    3.67180E-05
	       8192    8.87570E-05    6.93470E-05    7.12230E-05    6.88770E-05    7.03010E-05
	      16384    1.78587E-04    1.37081E-04    1.39347E-04    1.37177E-04    1.43894E-04
	      32768    3.61126E-04    2.72289E-04    3.05735E-04    2.72814E-04    2.80456E-04
	      65536    7.32460E-04    5.54868E-04    6.27720E-04    5.85945E-04    5.89385E-04
	     131072    1.53903E-03    1.18603E-03    1.20107E-03    1.35395E-03    1.16318E-03
	     262144    3.37021E-03    2.33165E-03    2.35212E-03    2.34700E-03    2.59126E-03
	     524288    6.35893E-03    5.18455E-03    4.78905E-03    4.77894E-03    5.26005E-03
	    1048576    1.20293E-02    1.01787E-02    9.33039E-03    9.68092E-03    9.38610E-03
	    2097152    2.45503E-02    1.97976E-02    1.87547E-02    2.01467E-02    2.00122E-02
	    4194304    5.21597E-02    3.88418E-02    3.91422E-02    3.85590E-02    4.06623E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    4.03230E-05    4.52800E-05    4.50680E-05    4.52240E-05    4.21690E-05
	       8192    8.77820E-05    8.75620E-05    8.82470E-05    8.86720E-05    8.85660E-05
	      16384    1.72947E-04    1.67371E-04    1.54634E-04    1.73446E-04    1.56629E-04
	      32768    3.45148E-04    3.44281E-04    3.50598E-04    3.44652E-04    3.50185E-04
	      65536    6.68915E-04    6.94981E-04    6.76087E-04    6.89623E-04    6.28061E-04
	     131072    1.29758E-03    1.31791E-03    1.26632E-03    1.52878E-03    1.25787E-03
	     262144    2.53009E-03    2.53858E-03    2.70279E-03    2.77794E-03    2.76061E-03
	     524288    5.72386E-03    5.11348E-03    5.10903E-03    5.35524E-03    5.38624E-03
	    1048576    1.05236E-02    1.02603E-02    1.13666E-02    1.03585E-02    1.06173E-02
	    2097152    2.12602E-02    2.07612E-02    2.13418E-02    2.06062E-02    2.07742E-02
	    4194304    4.27317E-02    4.67126E-02    4.13073E-02    4.20254E-02    4.71179E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    6.44720E-05    7.18190E-05    7.07190E-05    7.08060E-05    7.09590E-05
	       8192    1.42355E-04    1.39856E-04    2.04663E-04    1.39893E-04    1.39795E-04
	      16384    2.91131E-04    2.78460E-04    2.77903E-04    3.05991E-04    2.77991E-04
	      32768    5.25177E-04    5.56772E-04    5.54472E-04    5.55158E-04    5.55344E-04
	      65536    1.04942E-03    1.14112E-03    1.11531E-03    1.14666E-03    1.12737E-03
	     131072    2.06592E-03    2.01828E-03    2.16679E-03    2.15902E-03    1.95697E-03
	     262144    4.15348E-03    4.05189E-03    3.94045E-03    3.91147E-03    3.94511E-03
	     524288    7.93292E-03    7.91979E-03    7.96136E-03    7.97717E-03    7.85592E-03
	    1048576    1.64813E-02    1.58491E-02    1.58104E-02    1.57245E-02    1.59671E-02
	    2097152    3.16930E-02    3.16744E-02    3.16564E-02    3.15205E-02    3.27712E-02
	    4194304    6.32924E-02    6.36300E-02    6.32955E-02    6.31308E-02    6.37468E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.99877E-04    2.94247E-04    3.54443E-04    2.82777E-04    2.83454E-04
	       8192    5.53921E-04    5.52742E-04    6.14627E-04    5.76409E-04    5.62883E-04
	      16384    1.11578E-03    1.11604E-03    1.16528E-03    1.14146E-03    1.12187E-03
	      32768    2.23800E-03    2.23864E-03    2.40583E-03    2.33095E-03    2.30638E-03
	      65536    4.55628E-03    4.61620E-03    4.67463E-03    4.73058E-03    4.66695E-03
	     131072    9.06262E-03    8.99984E-03    9.35419E-03    9.32847E-03    9.40925E-03
	     262144    1.80852E-02    1.82274E-02    1.89101E-02    1.84449E-02    1.85434E-02
	     524288    3.63541E-02    3.62507E-02    3.81519E-02    3.63460E-02    3.70359E-02
	    1048576    7.37784E-02    7.26302E-02    7.55619E-02    7.17699E-02    7.40485E-02
	    2097152    1.43891E-01    1.44111E-01    1.48419E-01    1.46246E-01    1.44638E-01
	    4194304    2.92031E-01    3.00942E-01    2.96243E-01    2.90777E-01    2.92175E-01
	
	*********************************************
	
	  time_2d_nearest_neighbor_problem
	
	  Given x(2,n) and y(2),
	
	    find x(2,*) closest to y(2).
	
	    do i = 1, n
	      if distance( x(2,i), y ) < minimum so far
	        x_min = x(2,i)
	    end do
	
	  Data vectors will be of minimum size           1024
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       1024    1.95200E-05    1.90450E-05    2.04830E-05    1.97960E-05    1.99180E-05
	       2048    3.56230E-05    3.53540E-05    3.55430E-05    3.55970E-05    3.53060E-05
	       4096    7.09290E-05    7.10430E-05    7.02330E-05    6.95160E-05    7.07210E-05
	       8192    1.40456E-04    1.40269E-04    1.40376E-04    1.38412E-04    1.39235E-04
	      16384    2.79020E-04    3.00619E-04    2.79458E-04    2.76196E-04    2.80324E-04
	      32768    5.55701E-04    5.58890E-04    5.76385E-04    5.80506E-04    5.36697E-04
	      65536    1.11312E-03    1.11525E-03    1.11191E-03    1.14400E-03    1.07784E-03
	     131072    2.25631E-03    2.15710E-03    2.20037E-03    2.19676E-03    2.14980E-03
	     262144    4.46069E-03    4.46419E-03    4.42703E-03    4.45361E-03    4.34704E-03
	     524288    8.71746E-03    8.75345E-03    8.88099E-03    8.82827E-03    8.93905E-03
	    1048576    1.75365E-02    1.78918E-02    1.78759E-02    1.75820E-02    1.78085E-02
	
	*********************************************
	
	  time_matrix_multiplication_problem
	
	  Compute C = A * B
	
	  where
	    A is an L by M matrix,
	    B is an M by N matrix,
	  and so
	    C is an L by N matrix.
	
	  Minimum value of L = M = N =                      4
	  Maximum value of L = M = N =                   1024
	  Number of repetitions of the operation:           5
	
	  Use nested do loops for matrix multiplication.
	
	  Timing results using nested do loops:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    5.37000E-06    4.51900E-06    6.02100E-06    5.23200E-06    6.61200E-06
	         16    1.73467E-04    1.73531E-04    2.16965E-04    2.01359E-04    2.17028E-04
	         64    1.14483E-02    1.15183E-02    1.19382E-02    1.59798E-02    1.27246E-02
	        256    8.96401E-01    8.85332E-01    8.87394E-01    8.86218E-01    8.84446E-01
	       1024    2.11592E+02    2.27237E+02    2.26096E+02    2.27384E+02    2.28688E+02
	
	  Use the matmul routine for matrix multiplication.
	
	  Timing results using matmul:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    2.68236E-02    7.60000E-06    6.27700E-06    6.65500E-06    7.49200E-06
	         16    1.02190E-05    9.61700E-06    9.63600E-06    9.78800E-06    9.91000E-06
	         64    3.60338E-04    3.42295E-04    3.42905E-04    3.42327E-04    3.43165E-04
	        256    3.06011E-02    2.73525E-02    2.73152E-02    2.72720E-02    2.73322E-02
	       1024    3.19142E+00    3.15780E+00    3.16408E+00    3.14082E+00    3.14404E+00
	
	 type (CpuTimer) tests.
	
	 Normal end of execution.
	
	May 24 2016  10:58:30.274 AM
	
	This file was compiled by GCC version 6.1.1 20160511 using the options -I ../objs -I ../lib -mtune=generic -march=x86-64 -auxbase-strip ../objs/type_CpuTimer.o -Wall -fimplicit-none -fcheck=all -J ../lib

		
```