# **cpu\_timer - A modern Fortran (2008+) library for timing program execution**

An object-oriented library for computing elapsed CPU time. More specifically, you can determine the CPU time consumed by a particular piece of your code, that is:

```fortran

	!... start timer
	
	do i = 1, n
		
		!...some big calculation...
	
	end do
	
	!...stop timer
	
	print *, 'Elapsed CPU time = ', blah
```



-----------------------------------------------------------------------------

## Contributing

This project is still a work in progress and anyone is free to contribute under the proviso that they abstain from using the dreaded **go to**.

For bug reports or feature requests please open an issue on github.

-----------------------------------------------------------------------------

## Requirements
* The GNU Make tool https://www.gnu.org/software/make/
* The GNU gfortran compiler https://gcc.gnu.org/wiki/GFortran

-----------------------------------------------------------------------------

## To build the project

Type the following command line arguments
```
git clone https://github.com/jlokimlin/cpu_timer.git

cd cpu_timer; make all
```

-----------------------------------------------------------------------------

## Usage:

```fortran

use, intrinsic :: iso_fortran_env, only: &
    wp => REAL64, &
    ip => INT32
    
use type_CpuTimer, only: &
    CpuTimer

! Explicit typing only
implicit none

type (CpuTimer) :: timer
real (wp)       :: wall_clock_time
real (wp)	    :: total_processor_time
integer (ip)    :: units = 0 ! (optional argument) = 0 for seconds, or 1 for minutes, or 2 for hours

! Starting the timer
call timer%start()

! Stopping the timer
call timer%stop()

! Reading the time
wall_clock_time = timer%get_elapsed_time(units)

total_processor_time = timer%get_total_cpu_time(units)

! Write time stamp to standard output
call timer%print_time_stamp()

! Write compiler info to standard output
call timer%print_compiler_info()

```

-----------------------------------------------------------------------------

## Result

```

	Demonstrate the usage of type (CpuTimer).
	
	May  4 2016   8:33:23.955 AM
	
	*********************************************
	
	 time_random_number_routine
	
	 times the intrinsic random_number routine:
	
	    call random_number( x(1:n) )
	
	  Data vectors will be of minimum size              1
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         MINVAL         SUM            MAXVAL         
	
	          1    4.40000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.20000E-02    3.68000E-02    4.40000E-02
	          2    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	          4    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	          8    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	         16    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	         32    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	         64    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	        128    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	        256    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	        512    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	       1024    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	       2048    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	       4096    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	       8192    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	      16384    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	      32768    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	      65536    3.60000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	     131072    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	     262144    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	     524288    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02    3.60000E-02
	    1048576    3.60000E-02    3.60000E-02    3.20000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.52000E-02    3.60000E-02
	
	*********************************************
	
	  time_vectorized_exp_routine:
	
	    y(1:n) = x(1:n)  
	    y(1:n) = PI * x(1:n)  
	    y(1:n) = sqrt( x(1:n) )
	    y(1:n) = exp( x(1:n) )
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    4.40000E-02    2.40000E-02    2.80000E-02    2.80000E-02    2.40000E-02
	       8192    3.60000E-02    4.00000E-02    2.80000E-02    2.80000E-02    2.80000E-02
	      16384    2.80000E-02    2.80000E-02    2.80000E-02    2.40000E-02    3.20000E-02
	      32768    2.80000E-02    3.20000E-02    3.20000E-02    2.80000E-02    4.00000E-02
	      65536    2.80000E-02    2.80000E-02    2.80000E-02    2.80000E-02    2.80000E-02
	     131072    2.80000E-02    2.80000E-02    4.40000E-02    2.80000E-02    2.40000E-02
	     262144    2.80000E-02    3.20000E-02    3.60000E-02    2.80000E-02    2.80000E-02
	     524288    3.20000E-02    3.20000E-02    2.80000E-02    2.80000E-02    2.80000E-02
	    1048576    3.20000E-02    2.80000E-02    2.80000E-02    2.80000E-02    2.80000E-02
	    2097152    2.80000E-02    3.20000E-02    3.20000E-02    3.20000E-02    2.80000E-02
	    4194304    2.80000E-02    3.20000E-02    3.20000E-02    2.80000E-02    2.40000E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.80000E-02    3.20000E-02    2.80000E-02    3.20000E-02    3.20000E-02
	       8192    3.60000E-02    3.20000E-02    3.20000E-02    3.20000E-02    2.80000E-02
	      16384    3.20000E-02    3.60000E-02    3.60000E-02    3.20000E-02    3.20000E-02
	      32768    3.20000E-02    3.20000E-02    2.80000E-02    3.20000E-02    3.20000E-02
	      65536    3.20000E-02    2.80000E-02    3.20000E-02    3.20000E-02    3.20000E-02
	     131072    2.40000E-02    4.00000E-02    3.20000E-02    3.20000E-02    2.80000E-02
	     262144    3.20000E-02    3.60000E-02    2.80000E-02    3.20000E-02    3.20000E-02
	     524288    3.20000E-02    3.20000E-02    2.80000E-02    3.20000E-02    4.80000E-02
	    1048576    3.60000E-02    2.80000E-02    3.20000E-02    2.80000E-02    3.20000E-02
	    2097152    3.20000E-02    3.20000E-02    2.80000E-02    3.20000E-02    2.80000E-02
	    4194304    2.80000E-02    2.80000E-02    3.20000E-02    2.80000E-02    3.60000E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    6.00000E-02    6.00000E-02    5.60000E-02    8.40000E-02    6.80000E-02
	       8192    6.40000E-02    6.00000E-02    6.00000E-02    8.00000E-02    6.80000E-02
	      16384    7.20000E-02    5.60000E-02    7.20000E-02    7.20000E-02    6.40000E-02
	      32768    6.00000E-02    6.00000E-02    6.00000E-02    6.40000E-02    6.40000E-02
	      65536    6.00000E-02    6.00000E-02    6.40000E-02    7.20000E-02    6.40000E-02
	     131072    6.00000E-02    6.00000E-02    6.40000E-02    7.20000E-02    8.00000E-02
	     262144    7.20000E-02    6.00000E-02    6.40000E-02    7.60000E-02    6.00000E-02
	     524288    6.80000E-02    6.00000E-02    6.40000E-02    6.80000E-02    6.00000E-02
	    1048576    6.80000E-02    7.20000E-02    6.00000E-02    7.20000E-02    6.00000E-02
	    2097152    6.80000E-02    6.80000E-02    6.80000E-02    7.20000E-02    6.80000E-02
	    4194304    6.00000E-02    6.00000E-02    7.20000E-02    7.20000E-02    6.40000E-02
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    2.48000E-01    2.48000E-01    2.48000E-01    2.60000E-01    2.64000E-01
	       8192    2.48000E-01    2.48000E-01    2.44000E-01    2.56000E-01    2.68000E-01
	      16384    2.56000E-01    2.72000E-01    2.48000E-01    2.60000E-01    2.60000E-01
	      32768    2.64000E-01    2.52000E-01    2.44000E-01    2.56000E-01    2.60000E-01
	      65536    2.60000E-01    2.48000E-01    2.48000E-01    2.56000E-01    2.60000E-01
	     131072    2.56000E-01    2.48000E-01    2.60000E-01    2.48000E-01    2.60000E-01
	     262144    2.56000E-01    2.52000E-01    2.56000E-01    2.52000E-01    2.44000E-01
	     524288    2.56000E-01    2.48000E-01    2.56000E-01    2.56000E-01    2.48000E-01
	    1048576    2.52000E-01    2.48000E-01    2.56000E-01    2.60000E-01    2.44000E-01
	    2097152    2.48000E-01    2.48000E-01    2.56000E-01    2.60000E-01    2.44000E-01
	    4194304    2.48000E-01    2.48000E-01    2.60000E-01    2.60000E-01    2.48000E-01
	
	*********************************************
	
	 time_unvectorized_exp_routine
	
	    do i = 1, n
	      y(i) = x(i)  
	      y(i) = PI * x(i)  
	      y(i) = sqrt(x(i))
	      y(i) = exp(x(i))
	    end do
	
	  Data vectors will be of minimum size           4096
	  Data vectors will be of maximum size        4194304
	  Number of repetitions of the operation:           5
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       8192    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      16384    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      32768    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      65536    4.00000E-03    4.00000E-03    0.00000E+00    0.00000E+00    0.00000E+00
	     131072    0.00000E+00    0.00000E+00    0.00000E+00    4.00000E-03    4.00000E-03
	     262144    4.00000E-03    4.00000E-03    0.00000E+00    0.00000E+00    4.00000E-03
	     524288    8.00000E-03    4.00000E-03    8.00000E-03    4.00000E-03    4.00000E-03
	    1048576    1.20000E-02    1.20000E-02    1.20000E-02    1.20000E-02    1.20000E-02
	    2097152    3.20000E-02    2.00000E-02    2.40000E-02    2.40000E-02    2.00000E-02
	    4194304    5.60000E-02    4.40000E-02    4.40000E-02    4.40000E-02    4.40000E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       8192    4.00000E-03    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      16384    0.00000E+00    0.00000E+00    0.00000E+00    4.00000E-03    0.00000E+00
	      32768    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      65536    0.00000E+00    4.00000E-03    0.00000E+00    4.00000E-03    0.00000E+00
	     131072    0.00000E+00    0.00000E+00    4.00000E-03    0.00000E+00    0.00000E+00
	     262144    4.00000E-03    4.00000E-03    4.00000E-03    4.00000E-03    4.00000E-03
	     524288    8.00000E-03    8.00000E-03    8.00000E-03    8.00000E-03    8.00000E-03
	    1048576    1.20000E-02    1.60000E-02    1.20000E-02    1.20000E-02    1.20000E-02
	    2097152    2.40000E-02    2.80000E-02    2.40000E-02    2.40000E-02    2.40000E-02
	    4194304    5.20000E-02    5.20000E-02    4.80000E-02    4.80000E-02    5.20000E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       8192    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      16384    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    4.00000E-03
	      32768    4.00000E-03    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      65536    0.00000E+00    0.00000E+00    0.00000E+00    4.00000E-03    4.00000E-03
	     131072    4.00000E-03    4.00000E-03    4.00000E-03    0.00000E+00    0.00000E+00
	     262144    4.00000E-03    4.00000E-03    4.00000E-03    4.00000E-03    4.00000E-03
	     524288    8.00000E-03    8.00000E-03    8.00000E-03    8.00000E-03    8.00000E-03
	    1048576    1.60000E-02    1.60000E-02    1.60000E-02    1.60000E-02    1.60000E-02
	    2097152    3.20000E-02    3.60000E-02    3.20000E-02    3.20000E-02    3.20000E-02
	    4194304    6.80000E-02    6.40000E-02    6.80000E-02    6.40000E-02    6.80000E-02
	
	*********************************************
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       4096    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       8192    0.00000E+00    0.00000E+00    0.00000E+00    4.00000E-03    0.00000E+00
	      16384    0.00000E+00    4.00000E-03    4.00000E-03    0.00000E+00    0.00000E+00
	      32768    4.00000E-03    0.00000E+00    0.00000E+00    4.00000E-03    0.00000E+00
	      65536    4.00000E-03    4.00000E-03    4.00000E-03    8.00000E-03    4.00000E-03
	     131072    1.20000E-02    8.00000E-03    8.00000E-03    8.00000E-03    8.00000E-03
	     262144    1.60000E-02    1.60000E-02    2.00000E-02    2.00000E-02    2.00000E-02
	     524288    3.60000E-02    3.60000E-02    3.60000E-02    4.00000E-02    4.00000E-02
	    1048576    7.20000E-02    7.20000E-02    7.20000E-02    7.60000E-02    7.60000E-02
	    2097152    1.44000E-01    1.48000E-01    1.48000E-01    1.56000E-01    1.48000E-01
	    4194304    2.96000E-01    2.92000E-01    3.08000E-01    3.04000E-01    2.96000E-01
	
	*********************************************
	
	  time_2d_nearest_neighbor_problem
	
	  Given x(2,n) and y(2),
	
	    find x(2,*) closest to y(2).
	
	    do i = 1, n
	      if distance( x(2,i), y ) < minimum so far
	        x_min = x(2,i)
	    end do
	
	  Data vectors will be of minimum size           1024
	  Data vectors will be of maximum size        1048576
	  Number of repetitions of the operation:           5
	
	  Timing results:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	       1024    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       2048    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       4096    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	       8192    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      16384    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	      32768    0.00000E+00    4.00000E-03    0.00000E+00    4.00000E-03    0.00000E+00
	      65536    4.00000E-03    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	     131072    0.00000E+00    0.00000E+00    4.00000E-03    4.00000E-03    4.00000E-03
	     262144    4.00000E-03    8.00000E-03    4.00000E-03    4.00000E-03    4.00000E-03
	     524288    1.20000E-02    8.00000E-03    1.20000E-02    8.00000E-03    8.00000E-03
	    1048576    1.60000E-02    2.00000E-02    1.60000E-02    2.00000E-02    2.00000E-02
	
	*********************************************
	
	  time_matrix_multiplication_problem
	
	  Compute C = A * B
	
	  where
	    A is an L by M matrix,
	    B is an M by N matrix,
	  and so
	    C is an L by N matrix.
	
	  Minimum value of L = M = N =                      4
	  Maximum value of L = M = N =                   1024
	  Number of repetitions of the operation:           5
	
	  Use nested do loops for matrix multiplication.
	
	  Timing results using nested do loops:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	         16    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	         64    1.20000E-02    1.20000E-02    1.20000E-02    1.20000E-02    1.20000E-02
	        256    9.08000E-01    8.84000E-01    8.76000E-01    8.96000E-01    8.88000E-01
	       1024    2.31964E+02    2.27316E+02    2.36012E+02    2.21132E+02    2.38936E+02
	
	  Use the matmul routine for matrix multiplication.
	
	  Timing results using matmul:
	
	       Size    Rep #1         Rep #2         Rep #3         Rep #4         Rep #5         
	
	          4    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	         16    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	         64    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00    0.00000E+00
	        256    2.80000E-02    2.80000E-02    2.80000E-02    2.80000E-02    2.80000E-02
	       1024    3.39200E+00    3.36800E+00    3.46400E+00    3.42800E+00    3.37200E+00
	
	 type (CpuTimer) tests.
	
	 Normal end of execution.
	
	May  4 2016   8:54:16.312 AM
	
	This file was compiled by GCC version 5.3.1 20160409 using the options -I ../objs -I ../lib -mtune=generic -march=x86-64 -auxbase-strip ../objs/type_CpuTimer.o -Wall -fimplicit-none -fcheck=all -J ../lib
		
```